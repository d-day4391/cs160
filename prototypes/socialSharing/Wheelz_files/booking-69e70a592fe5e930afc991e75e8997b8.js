((function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};window.AvailabilityDisplayController=function(){function b(a){this.dayMS=864e5,this.hourMS=this.dayMS/24,this.target=$(a.target),this.vehicleId=a.vehicleId,a.start&&a.end&&this.setTime(a.start,a.end)}return b.prototype.setTime=function(a,b){var c,d;return this.reservationStartTime=new Date,this.reservationStartTime.setTime(a),this.reservationEndTime=new Date,this.reservationEndTime.setTime(b),this.startDateString=this.reservationStartTime.getDate()+"/"+this.reservationStartTime.getMonth()+"/"+this.reservationStartTime.getFullYear(),this.endDateString=this.reservationEndTime.getDate()+"/"+this.reservationEndTime.getMonth()+"/"+this.reservationEndTime.getFullYear(),this.startDateString===this.endDateString?(d=new Date,d.setTime(this.reservationStartTime),d.setHours(0),d.setMinutes(0),d.setSeconds(0),c=new Date,c.setTime(d.getTime()+this.dayMS),this.drawIntraDay(d,c)):(d=new Date,d.setTime(this.reservationStartTime),d.setHours(0),d.setMinutes(0),d.setSeconds(0),c=new Date,c.setTime(d.getTime()+this.dayMS*6),this.drawInterDay(d,c))},b.prototype.drawIntraDay=function(b,c){return $.ajax("/vehicles/"+this.vehicleId+"/get_events?start="+b.getTime()/1e3+"&end="+c.getTime()/1e3,{dataType:"json",success:a(function(a,c,d){var e,f,g,h,i,j,k,l,m;this.target.html('<div class="table"><div class="row"><div class="label_cell">12 am</div><div class="label_cell">6 am</div><div class="label_cell">12 pm</div><div class="label_cell">6 pm</div></div></div>'),h=$('<div class="row"></div>'),k=$('<div class="table"></div>').append(h);for(g=0;g<=95;g++)g%4===0?h.append('<div class="cell quarter_hour hour_border"/>'):h.append('<div class="cell quarter_hour"/>');for(l=0,m=a.length;l<m;l++){f=a[l],i=this.parseDateTime(f.start),e=this.parseDateTime(f.end);for(g=0;g<=95;g++)j=b.getTime()+g*9e5,i.getTime()<=j&&e.getTime()>=j&&h.find(".cell").eq(g).addClass("booked")}for(g=0;g<=95;g++)j=b.getTime()+g*9e5,this.reservationStartTime.getTime()<=j&&this.reservationEndTime.getTime()>=j&&h.find(".cell").eq(g).addClass("mine");return this.target.append(k)},this)})},b.prototype.drawInterDay=function(b,c){var d;return d=["Sun","Mon","Tues","Wed","Thurs","Fri","Sat"],$.ajax("/vehicles/"+this.vehicleId+"/get_events?start="+b.getTime()/1e3+"&end="+c.getTime()/1e3,{dataType:"json",success:a(function(a,e,f){var g,h,i,j,k,l,m,n,o,p,q;k=$('<div class="table"><div class="row"></div></div>'),n=new Date,n.setTime(b.getTime()),g=function(){var a;a=[];while(n.getTime()<c.getTime())k.append('<div class="label_cell week">'+d[n.getDay()]+"</div>"),a.push(n.setTime(n.getTime()+this.dayMS));return a}.call(this),this.target.html(k),l=$('<div class="row"></div>'),o=$('<div class="table"></div>').append(l),n.setTime(b.getTime()),j=0,g=function(){var a;a=[];while(n.getTime()<c.getTime())j%6===0?l.append('<div class="cell hour quarter_day_border"/>'):l.append('<div class="cell hour"/>'),n.setTime(n.getTime()+this.hourMS),a.push(j++);return a}.call(this);for(p=0,q=a.length;p<q;p++)i=a[p],m=this.parseDateTime(i.start),h=this.parseDateTime(i.end),n=b.getTime(),j=0,g=function(){var a;a=[];while(n<c.getTime())(m.getTime()<=n&&h.getTime()>=n||n<=m.getTime()&&m.getTime()<=n+this.hourMS||n<=h.getTime()&&h.getTime()<=n+this.hourMS)&&l.find(".cell").eq(j).addClass("booked"),n+=this.hourMS,a.push(j++);return a}.call(this);return n=b.getTime(),j=0,g=function(){var a;a=[];while(n<c.getTime())m=this.reservationStartTime.getTime(),h=this.reservationEndTime.getTime(),(m<=n&&h>=n||n<=m&&m<=n+this.hourMS||n<=h&&h<=n+this.hourMS)&&l.find(".cell").eq(j).removeClass("booked").addClass("mine"),n+=this.hourMS,a.push(j++);return a}.call(this),this.target.append(o)},this)})},b.prototype.parseDateTime=function(a){var b,c;return c=a.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})([-+]\d{2}):(\d{2})/),b=new Date(Date.UTC(parseInt(c[1],10),parseInt(c[2],10)-1,parseInt(c[3],10),parseInt(c[4],10),parseInt(c[5],10),parseInt(c[6],10),0)),b.setTime(b.getTime()-parseInt(c[7],10)*36e5),b},b}()})).call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};window.ReservationCancelLink=function(){function b(b){this.cancelLink=$("a#cancel_link"),this.cancelLink.bind("click",a(function(a){return this.cancelModal(a)},this)),this.cancelNotInProgress=!0,this.cancelUrl=b.url,this.endLink=$("a#end_reservation_link"),this.endLink.bind("click",a(function(a){return this.endModal(a)},this))}return b.prototype.cancelModal=function(b){var c;return b.preventDefault(),this.cancelLink.html("Cancelling ..."),this.cancelLink.addClass("btn-disabled"),c=this.cancelUrl,$.post(c,{_method:"PUT"},a(function(b){var d;return b.errors.length>0?(this.displayError("There was an error."),this.cancelLink.html("Cancel Reservation"),this.cancelLink.removeClass("btn-disabled")):(d="Are you sure you want to cancel your reservation?",utils.isEmpty(b.consequences)||(d='<span class="txt-red">'+b.consequences.cancelling_too_close_to_start_time.description+"</span><br><br>"+d),ui.modalDialog({title:"Cancel Reservation",content:d,actions:{Yes:function(){return $.post(c,{confirm_cancel:!0,_method:"PUT"},a(function(a){a.success&&(window.location=a.next_url);if(a.errors.length>0)return ui.currentDialog().close(),this.displayError("There was an error.")},this))},No:function(){return ui.currentDialog().close(),$("a#cancel_link").removeClass("btn-disabled").html("Cancel Reservation")}}}))},this))},b.prototype.endModal=function(a){if(this.endLink.hasClass("confirm"))return a.preventDefault(),this.endLink.removeAttr("data-method").addClass("btn-disabled"),ui.modalDialog({title:"End Reservation",content:"Are you sure you want to end your reservation?",actions:{Yes:function(){return ui.currentDialog().close(),$("a#end_reservation_link").attr("data-method","put").removeClass("confirm btn-disabled").trigger("click"),$("a#end_reservation_link").removeClass("confirm btn-disabled").trigger("click")},No:function(){return ui.currentDialog().close(),$("a#end_reservation_link").removeClass("btn-disabled")}}})},b.prototype.displayError=function(a){return $(".flash.notice").hide(),$("<div/>",{"class":"flash error",html:a}).prependTo("#content")},b}()}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};window.ReservationFormController=function(){function b(b){this.createReservationForm=$("#reservation_form"),this.calculateUrl=b.calculateUrl,this.applyCouponUrl=b.applyCouponUrl,b.startTime&&(this.startTime=new Date,this.startTime.setTime(b.startTime*1e3)),b.endTime&&(this.endTime=new Date,this.endTime.setTime(b.endTime*1e3)),this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.lengthTextArea=$("td.length"),this.priceTextArea=$("td.price"),this.hasErrors=!1,this.startDateTextArea=$("#reservation_start_date"),this.endDateTextArea=$("#reservation_end_date"),this.socialMessageTextArea=$("#reservation_social_share_attributes_body"),this.socialMessageTextArea.bind("keypress",a(function(a){return this.onSocialChanged(a)},this)).on("focus",a(function(a){return this.onSocialFocus()},this)).on("blur",a(function(a){return this.onSocialChanged()},this)),this.socialOptoutCheckbox=$("#reservation_social_share_attributes_share_on_facebook"),this.socialOptoutCheckbox.bind("change",a(function(a){return this.onSocialChanged()},this)),this.socialFriendsSelect=$("#reservation_social_share_friend_ids"),this.socialFriendsSelect.bind("change",a(function(a){return this.onSocialChanged()},this)),this.showDriverProfileLink=$("#ratesAndSocial #driver_request #show_driver_profile"),this.showDriverProfileLink.on("click",this.onShowDriverProfile),$("#reservation_submit").length>0&&(this.submitButton=$("#reservation_submit"),this.submitButton.bind("click",a(function(a){return this.onSubmit(a)},this))),$("#reservation_save").length>0&&(this.submitButton=$("#reservation_save"),this.submitButton.bind("click",a(function(a){return this.onSubmit(a)},this))),$("#reservation_apply_coupon").length>0&&(this.applyCouponButton=$("#reservation_apply_coupon"),this.applyCouponButton.bind("click",a(function(a){return this.onApplyCoupon(a)},this))),$("#useCouponLink").length>0&&$("#useCouponLink a").bind("click",a(function(a){return $("#useCouponLink").hide(),$("#useCouponForm").show(),!1},this)),this.socialMessageTextArea.length>0&&this.socialMessageTextArea.val().length===0&&(this.socialMessageTextArea.prop("defaultText")||this.socialMessageTextArea.prop("defaultText","Where You Headed?"),this.socialMessageTextArea.val(this.socialMessageTextArea.prop("defaultText")).addClass("default")),this.basePrice=$("#base_price"),this.basePriceBasis=$("#base_price_basis"),this.totalTime=$("#total_time"),this.totalCost=$("#total_cost"),this.totalTax=$("#total_tax"),this.coupon=$("#coupon"),this.drivingCredit=$("#driving_credit"),this.milesIncluded=$("#miles_included"),this.excessMileage=$("#excess_mileage_rate"),this.transaction=$("#transaction"),this.subtotal=$("#subtotal"),this.fuelCostEstimate=$("#fuel_cost_estimate"),this.fuelRate=$("#fuel_rate"),this.fuelCostEstimateBasis=$("#fuel_cost_estimate_basis"),this.startTimeSelect=$("#reservation_start_localtime"),this.endTimeSelect=$("#reservation_end_localtime"),$("#reservation_organization_id").length>0&&(this.bill_to=$("#reservation_organization_id"),this.bill_to.bind("change",a(function(a){return this.onBillToChange()},this))),$("#reservation_start_localtime").length>0&&this.startTimeSelect.bind("change",a(function(a){return this.onStartTimeChange()},this)),$("#reservation_end_localtime").length>0&&this.endTimeSelect.bind("change",a(function(a){return this.onEndTimeChange()},this)),$("#rentMe").length>0&&$("#rentMe").live("click",a(function(){return this.onUpdate(),this.showReservationTools(!0)},this)),$("#reservationEditDetails .errors li").size()>0&&($("#reservationEditDetails .errors").slideDown(),this.showReservationTools(),this.showReservationResults(),this.hasErrors=!0),this.initDateTimes()}return b.prototype.showReservationTools=function(a){return a?$("#rentMe").slideUp(200):$("#rentMe").hide(),$("#reservationTools").slideDown(400)},b.prototype.showReservationResults=function(){return $("#reservationResults").slideDown(500,function(){return ui.forms.rerenderInputs($("#reservationResults"))})},b.prototype.initDateTimes=function(){var a;a=!1,utils.getURLParameter("start_time")&&utils.getURLParameter("end_time")&&(this.startTime=new Date,this.startTime.setTime(utils.getURLParameter("start_time")*1e3),this.endTime=new Date,this.endTime.setTime(utils.getURLParameter("end_time")*1e3),a=!0,this.startTime.getTime()<$.now()&&this.setNextPossible()),(!this.startTime||!this.endTime)&&this.setNextPossible(),this.setDateTimes(),this.initializeDatePickers(),a&&(this.showReservationTools(),this.showReservationResults());if(window.availabilityDisplayController)return window.availabilityDisplayController.setTime(this.startTime.getTime(),this.endTime.getTime())},b.prototype.setNextPossible=function(){var a,b,c;return c=new Date,a=c.getMinutes(),b=Math.ceil((a+1)/15)*15,c.setMinutes(b),c.setSeconds(0),c.setMilliseconds(0),this.startTime=c,this.endTime=new Date,this.endTime.setTime(this.startTime.getTime()+18e5)},b.prototype.setDateTimes=function(){return this.startDateTextArea.val(date.toDateString(this.startTime)),this.endDateTextArea.val(date.toDateString(this.endTime)),$("#reservation_start_localtime").val(date.toTimeString(this.startTime)).trigger("liszt:updated"),$("#reservation_end_localtime").val(date.toTimeString(this.endTime)).trigger("liszt:updated")},b.prototype.initializeDatePickers=function(){var b,c;return b={buttonImage:"/images/global/calendar_icon.png",buttonImageOnly:!0,showOn:"both",dateFormat:"m/d/yy"},this.startDateTextArea.datepicker({buttonImage:"/images/global/calendar_icon.png",buttonImageOnly:!0,showOn:"button",dateFormat:"M dd",minDate:new Date,onClose:a(function(a,b){return this.onStartTimeChange()},this)}),c=new Date,c.setTime(c.getTime()+18e5),this.endDateTextArea.datepicker({buttonImage:"/images/global/calendar_icon.png",buttonImageOnly:!0,showOn:"button",dateFormat:"M dd",minDate:c,onClose:a(function(a,b){return this.onEndTimeChange()},this)})},b.prototype.onStartTimeChange=function(){return this.startTime=date.getDateTime(this.startDateTextArea,this.startTimeSelect),this.startTime.getTime()+18e5>this.endTime.getTime()&&this.endTime.setTime(this.startTime.getTime()+18e5),this.startTime.getTime()<$.now()&&this.setNextPossible(),this.setDateTimes(),this.onTimespanChange()},b.prototype.onEndTimeChange=function(){return this.endTime=date.getDateTime(this.endDateTextArea,this.endTimeSelect),this.startTime.getTime()+18e5>this.endTime.getTime()&&this.startTime.setTime(this.endTime.getTime()-18e5),this.startTime.getTime()<$.now()&&this.setNextPossible(),this.setDateTimes(),this.onTimespanChange()},b.prototype.onTimespanChange=function(){return window.availabilityDisplayController&&window.availabilityDisplayController.setTime(this.startTime.getTime(),this.endTime.getTime()),this.clearAlerts(),this.submitButton&&this.submitButton.attr("disabled","disabled"),this.totalTime&&this.totalTime.text("--"),this.milesIncluded&&this.milesIncluded.text("--"),this.basePrice&&this.basePrice.text("--"),this.basePriceBasis&&this.basePriceBasis.text(""),this.totalCost.text("--"),this.totalTax.text("--"),this.transaction&&this.transaction.text("--"),this.hideErrors(),this.onUpdate()},b.prototype.onBillToChange=function(){return this.submitButton.removeAttr("disabled")},b.prototype.onSocialChanged=function(a){return!this.socialMessageTextArea.val()&&(a===void 0||a.type!=="keypress")&&(this.socialMessageTextArea.val(this.socialMessageTextArea.prop("defaultText")),this.socialMessageTextArea.addClass("default")),this.submitButton.removeAttr("disabled")},b.prototype.onSocialFocus=function(){return this.socialMessageTextArea.val()===this.socialMessageTextArea.prop("defaultText")&&this.socialMessageTextArea.val(""),this.socialMessageTextArea.removeClass("default")},b.prototype.onShowDriverProfile=function(){return $("#driver_profile").toggle(0,function(a){return $(this).is(":visible")?$("#show_driver_profile").addClass("expanded"):$("#show_driver_profile").removeClass("expanded")}),!1},b.prototype.updateEstimates=function(a){return this.totalCost.text(a.price),this.basePrice.text(a.base_price),this.basePriceBasis.text(a.base_price_basis),this.subtotal.text(a.subtotal),this.totalTax.text(a.tax),a.transaction_fee&&a.transaction_fee!=="$0.00"&&(this.transaction.text(a.transaction_fee),this.drivingCredit.parents(".infoRow").show()),a.driving_credit!=="$0.00"?(this.drivingCredit.text(a.driving_credit),this.drivingCredit.parents(".infoRow").show()):this.drivingCredit.parents(".infoRow").hide(),a.coupon!=="$0.00"?(this.coupon.text(a.coupon),this.coupon.parents(".infoRow").show()):this.coupon.parents(".infoRow").hide(),a.fuel_passthrough?(this.fuelCostEstimate.text(a.fuel_cost_estimate),this.fuelCostEstimateBasis.text(a.fuel_cost_estimate_basis),this.fuelRate.text(a.fuel_rate)):(this.milesIncluded.text(a.miles_included),this.excessMileage.text(a.excess_mileage_rate))},b.prototype.handleUpdateCallback=function(a){var b,c,d,e,f,g,h;ui.hideWorkingOverlay(),this.priceTextArea.removeClass("updating"),this.lengthTextArea.removeClass("updating"),a.reservation&&this.updateEstimates(a.reservation);if(a.errors){h=a.errors;for(e in h){d=h[e];for(f=0,g=d.length;f<g;f++)c=d[f],this.displayError(c)}}else this.hideErrors(),this.submitButton&&this.submitButton.removeAttr("disabled");a.consequences&&(b=a.consequences.pushing_out_start_time_when_too_close_to_start_time)&&this.displayAlert(b.description);if(!this.hasErrors)return $(".reservationDetailsPane").show()},b.prototype.handleApplyCouponCallback=function(a){a.errors&&$("#useCouponForm .error").html(a.errors[0]).slideDown(300),a.reservation&&(this.updateEstimates(a.reservation),$("#useCouponForm").hide());if(this.applyCouponButton)return this.applyCouponButton.removeAttr("disabled")},b.prototype.startTimeFieldsEditable=function(){return this.startDateTextArea.length>0},b.prototype.handleEndBeforeStart=function(){return this.displayError("You can't return the car before you pick it up!")},b.prototype.handleZeroLengthReservation=function(){return this.displayError("You've got to rent the car for at least 15 minutes!")},b.prototype.clearAlerts=function(){return $(".flash").remove()},b.prototype.displayAlert=function(a){return $("<div/>",{"class":"flash alert",text:a}).prependTo("#content")},b.prototype.displayError=function(a){return this.hasErrors=!0,a=a.replace(/\\"/,'"'),$("#error_list").html($("<li>"+a+"</li>")),$(".errors").slideDown(200)},b.prototype.hideErrors=function(){return this.hasErrors=!1,$("#reservationEditDetails .errors").hide(),$("#reservationEditDetails .errors li").remove()},b.prototype.onSubmit=function(a){return a.preventDefault(),this.hasErrors?!1:(this.submitButton&&this.submitButton.attr("disabled","disabled"),this.socialMessageTextArea.val()===this.socialMessageTextArea.prop("defaultText")&&this.socialMessageTextArea.val(""),this.createReservationForm.submit())},b.prototype.onUpdate=function(){var b;return ui.showWorkingOverlay($("#reservationResults")),b=$("#reservation_form").serialize(),$.post(this.calculateUrl,b,a(function(a){return this.handleUpdateCallback(a)},this)),this.showReservationResults()},b.prototype.onApplyCoupon=function(b){var c;return $("#reservation_coupon_codes").val()===""?!1:($("#useCouponForm .error").hide(),b.preventDefault(),this.applyCouponButton&&this.applyCouponButton.attr("disabled","disabled"),c=$("#reservation_form").serialize(),$.post(this.applyCouponUrl,c,a(function(a){return this.handleApplyCouponCallback(a)},this)))},b}()}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};window.ReservationUpdateController=function(){function b(b){this.endTimeText=$("#reservation_form .end_time"),this.lengthTextArea=$("#reservation_form .length"),this.priceTextArea=$("#reservation_form .price"),this.linkAddHalfHour=$("#add_half_hour"),this.linkAddHalfHour.bind("click",a(function(a){return this.addHalfHour()},this)),this.addHalfHourUrl=b.add_half_hour_url,window.availabilityDisplayController=new window.AvailabilityDisplayController({start:b.start*1e3,end:b.end*1e3,target:"#availabilitySchedule",vehicleId:b.vehicleId})}return b.prototype.addHalfHour=function(){return this.endTimeText.addClass("updating"),this.lengthTextArea.addClass("updating"),this.priceTextArea.addClass("updating"),$.post(this.addHalfHourUrl,{_method:"PUT"},a(function(a){return this.handleServerCallback(a)},this))},b.prototype.handleServerCallback=function(a){this.endTimeText.removeClass("updating"),this.lengthTextArea.removeClass("updating"),this.priceTextArea.removeClass("updating");if(a.reservation)return this.priceTextArea.html(a.reservation.price),this.lengthTextArea.html(a.reservation.timespan),this.endTimeText.html(a.reservation.new_end_time);if(a.error)return $(".flash").remove(),$("<div/>",{"class":"flash error lessmarg",text:a.errors.base[0]}).prependTo("#content")},b}()}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};window.SearchPageController=function(){function b(a){this.config=a,this.user=a.user,this.vehicles=a.vehicles||[],this.addressField=$("#vehicle_search_address"),this.startDateTextArea=$("#vehicle_search_start_date"),this.endDateTextArea=$("#vehicle_search_end_date"),this.startTimeSelect=$("#vehicle_search_start_localtime"),this.endTimeSelect=$("#vehicle_search_end_localtime"),this.mapElement=$("#map"),this.resultsWidth=$("#results").outerWidth(),this.toolbarBottom=$("#toolbar").outerHeight()+parseInt($("#toolbar").css("top")),this.startTime=null,this.endTime=null,this.anytimeMode=!0,this.vehicleIndexToMarkerMap={},this.max_pin_z_index=100,this.blurVehicleTimeout=null,this.focusedVehicleId=null,this.metersPerMile=1609.34,this.defaultZoom=12,this.defaultRadius=15,this.query=new SearchRequestParams({lat:a.lat,lng:a.lng}),this.initSavedSearch(),this.initDateTimes(),this.setDateTimes(),this.drawMap(),this.bindEventHandlers(),this.showEducation()}return b.prototype.initSavedSearch=function(){var a;this.restoredSearch=!1,a=$.bbq.getState("lastSearch");if(a&&(a.address!==null||a.lat!==null)){this.query.params=$.extend({},a),this.addressField.val(this.query.params.address||""),this.restoredSearch=!0;if(a.start_time&&a.end_time)return this.setAnytime(!1),this.startTime=date.dateFromISOString(a.start_time),this.endTime=date.dateFromISOString(a.end_time),this.setDateTimes()}},b.prototype.bindEventHandlers=function(){var b,c,d;$("#new_vehicle_search").live("submit",a(function(a){return a.preventDefault(),this.doSearch("reset")},this)),this.startTimeSelect.length>0&&this.startTimeSelect.live("change",a(function(a){return this.onStartTimeChange()},this)),this.endTimeSelect.length>0&&this.endTimeSelect.live("change",a(function(a){return this.onEndTimeChange()},this)),$(".vehicle").live("click",a(function(a){var b;return b=$(a.currentTarget).find(".carPageLink").attr("href"),!this.anytimeMode&&this.startTime&&this.endTime&&(b+="?start_time="+this.startTime.getTime()/1e3+"&end_time="+this.endTime.getTime()/1e3),document.location.href=b,!1},this)),$("#results .vehicle").live("mouseenter",a(function(a){var b;return b=$(a.currentTarget).attr("id").split("_")[2],this.focusVehicle($(a.currentTarget).index())},this)).live("mouseleave",a(function(a){var b;return b=$(a.currentTarget).attr("id").split("_")[2],this.blurVehicle($(a.currentTarget).index())},this)),$("#results .vehicle .driver_action .request_access").live("click",a(function(a){return this.generateSearchObject(),this.pushSearchState(),ui.showWorkingOverlay($(a.target)),$.ajax({url:$(a.target).attr("href")+"/ajax_request_access",type:"POST",context:$(a.target),success:function(){}}),!1},this)),c=$(".help_permission"),b=c.find("#help_contents"),b.dialog({autoOpen:!1,draggable:!1,modal:!0,resizable:!1,dialogClass:"permission_dialog"}),c.on("click","#help_link",a(function(){return b.dialog("open")},this)),d=$(".friends img.mutual_friend_picture[src*='graph.facebook.com']").map(function(){var a;a=$(this).attr("src").match(/\/(\d+)\//);if(a!==null)return a[1]}),d=$.grep(d,function(a,b){return b===$.inArray(a,d)});if(d.length>0)return $.post("/users/fb_user_attributes.json",{uids:d},function(a){return $(a).each(function(a,b){return $('.friends img.mutual_friend_picture[src*="/'+b.uid+'"]').attr("tooltip",b.name)})})},b.prototype.showEducation=function(){if(this.config.first_time_instructions&&!$.cookie("dismissed_first_time_search"))return ui.createDialog({content:"<h1>How To Get Into A Car</h1><img src='/images/vehicles/how_to_get_in.jpg' /><a href='#' id='close_first_time_instructions'>Ok let me go check out some cars! &raquo; ",width:600,easyClose:!0,onClose:function(){return $.cookie("dismissed_first_time_search",!0)}}).open(function(){return $("#dialogContainer a#close_first_time_instructions").on("click",function(){return ui.activeDialog.close(),!1})})},b.prototype.initDateTimes=function(){var b,c;this.startDateTextArea.datepicker({showOn:"button",buttonImage:"/images/global/calendar_icon.png",buttonImageOnly:!0,dateFormat:"M dd",minDate:new Date,onClose:a(function(a,b){return this.onStartTimeChange()},this)}),this.endDateTextArea.datepicker({showOn:"button",buttonImage:"/images/global/calendar_icon.png",buttonImageOnly:!0,dateFormat:"M dd",minDate:new Date,onClose:a(function(a,b){return this.onEndTimeChange()},this)});if(!this.startTime||!this.endTime)this.startTime=date.nextPossibleReservationStart(),this.endTime=new Date,this.endTime.setTime(this.startTime.getTime()+18e5);return c=date.toTimeString(this.startTime),b=date.toTimeString(this.endTime),this.startTimeSelect.val(c),this.startTimeSelect.trigger("liszt:updated"),this.endTimeSelect.val(b),this.endTimeSelect.trigger("liszt:updated")},b.prototype.setDateTimes=function(){return this.startTime.getTime()<$.now()&&$("#toolbar .totals").html("Search cannot begin in the past"),this.startDateTextArea.val(date.toDateString(this.startTime)),this.endDateTextArea.val(date.toDateString(this.endTime)),this.anytimeMode?(this.startTimeSelect.val("").trigger("liszt:updated"),this.endTimeSelect.val("").trigger("liszt:updated")):(this.startTimeSelect.val(date.toTimeString(this.startTime)).trigger("liszt:updated"),this.endTimeSelect.val(date.toTimeString(this.endTime)).trigger("liszt:updated"))},b.prototype.setAnytime=function(a){return $("#vehicle_search_anytime").val(a?"true":"false"),this.anytimeMode=a},b.prototype.generateSearchObject=function(){var a;return this.addressField.val()===""?this.query.set({address:null,radius:null}):(this.query.setViewport(null,null,null,null),this.query.set({address:this.addressField.val(),radius:this.defaultRadius,lat:null,lng:null})),this.startTime&&this.endTime&&this.query.set({start_time:date.toDateTimeString(this.startTime),end_time:date.toDateTimeString(this.endTime)}),this.anytimeMode?this.query.set("anytime",!0):this.query.set("anytime",null),a={vehicle_search:{restrict_user_access:!1}},$.extend(a.vehicle_search,this.query.apiSafeParams()),a},b.prototype.pushSearchState=function(){return $.bbq.removeState("lastSearch"),$.bbq.pushState({lastSearch:this.query.params})},b.prototype.doSearch=function(b){var c;return c=this.generateSearchObject(),JSON.stringify(c)===this.lastSearch?!1:this.searchInProgress?(this.queuedSearch=!0,!1):(this.searchInProgress=!0,this.lastSearch=JSON.stringify(c),$("#errorContainer").remove(),this.showProgressIndicator(),$("#results").fadeTo(200,.5),this.pushSearchState(),$.ajax("/vehicles/search.json",{type:"POST",dataType:"json",data:c,success:a(function(a){return this.completeSearch(),a.lat!==this.query.params.lat&&a.lng!==this.query.params.lng&&(this.query.set({lat:a.lat,lng:a.lng}),this.pushSearchState()),b==="reset"?(this.repositionMap(),this.resetZoom()):b==="restore"&&this.restoreMap(),this.renderVehicles(a.vehicles||[])},this),error:a(function(a){var b;this.completeSearch(),b=JSON.parse(a.responseText);if(b.radius)return this.showError(b.radius[0])},this),complete:a(function(){return this.hideProgressIndicator()},this)}))},b.prototype.completeSearch=function(){this.searchInProgress=!1;if(this.queuedSearch)return this.queuedSearch=!1,this.doSearch()},b.prototype.showError=function(a){var b;return b=$('<div id="errorContainer"><div id="errorContainerInner"><div class="errors"><h1 class="center thin">'+a+"</h1></div></div></div>"),$("#mapFrame").append(b)},b.prototype.showProgressIndicator=function(){return $(".totals").html('<img src="/images/global/search-working-spinner.gif" style="vertical-align: middle; margin-right: 6px"> Searching...').addClass("working")},b.prototype.hideProgressIndicator=function(){return $("#results").fadeTo(200,1),$(".totals").removeClass("working")},b.prototype.renderVehicles=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;$("#results .vehicles").html(""),e=0,a.length===0?$("#toolbar .totals").html("No vehicles found"):a.length===1?$("#toolbar .totals").html("1 vehicle found"):$("#toolbar .totals").html(a.length+" vehicles found");if(a.length)for(j=0,l=a.length;j<l;j++){h=a[j],i=$('<div class="vehicle" id="vehicle_search_'+h.id+'"></div>'),i.append('<div class="number">'+(e+1)+"</div>"),h.highlight_photo_url&&i.append('<div class="featurePhoto"><img src="'+h.highlight_photo_url+'"></div>'),i.append('<div class="details"></div>'),b=i.find(".details"),b.append("<h3>"+h.make+" "+h.model+' <span class="year">'+h.year+"</span></h3>"),h.base_price&&!this.anytimeMode?b.append('<div class="rates"><span class="price">$'+h.base_price+'</span> <div class="estimated">(estimated)</div></div>'):b.append('<div class="rates"><span class="price">$'+h.price_per_hour+"</span>/hour</div>"),b.append('<div class="ownerPhoto"><img alt="" src="'+h.owner.profile_picture_url+'" tooltip="'+h.owner.first_name+" "+h.owner.last_name[0]+'."></div>'),this.user&&this.user.driver_signup_complete&&this.user.approved_to_drive&&(!h.has_manual_transmission||this.user.manual_proficiency)?h.owner.id===this.user.id?b.append('<div class="driver_action"><a href="/vehicles/'+h.id+'/schedule" class="button small orange">Update Schedule</a></div>'):h.can_reserve?(i.addClass("bookNow"),b.append('<div class="driver_action"><a href="/vehicles/'+h.id+'" class="button small orange">Book Instantly</a></div>')):h.has_requested_access?b.append('<div class="driver_action"><span class="check">Access Requested</span></div>'):b.append('<div class="driver_action"><a href="/vehicles/'+h.id+'" class="button small request_access">Request Access</a></div>'):b.append('<div class="ownerText"><div class="name">'+h.owner.first_name+" "+h.owner.last_name[0]+".</div></div>"),h.available||(i.addClass("unavailable"),i.append('<div class="clear"/><div class="restrictionMessage"><div class="message">Unavailable at this time</div></div>')),h.has_manual_transmission&&this.user&&!this.user.manual_proficiency&&(i.addClass("unavailable"),i.append('<div class="clear"/><div class="restrictionMessage"><div class="message">Manual transmission drivers only</div></div>')),b.append('<div class="arrow"></div>'),b.append('<a href="/vehicles/'+h.id+'" class="carPageLink"></a>'),i.append('<div class="clear"></div>');if(h.mutual_friends&&h.mutual_friends.length>0){d=$('<div class="friends">Your friends know this owner</div>'),i.append(d),g=$("<div/>"),d.append(g),f=0,n=h.mutual_friends;for(k=0,m=n.length;k<m;k++){c=n[k];if(c.first_name&&c.last_name){g.append('<img alt="" class="mutual_friend_picture" src="'+c.profile_picture_url+'" tooltip="'+c.first_name+" "+c.last_name+'">');if(f===11)break;f++}}}e++,$("#results .vehicles").append(i)}return ui.hideWorkingOverlay(),$("#results").fadeTo(200,1),$("body").scrollTop(0),this.reDrawMarkers(a)},b.prototype.drawMap=function(){var b,c;return this.googleMapOptions={zoom:this.query.getZoom(),center:this.query.gLatLng(),mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1},this.map=new google.maps.Map(this.mapElement.get(0),this.googleMapOptions),c={bounds:new google.maps.LatLngBounds(new google.maps.LatLng(38.654416,-123.055121),new google.maps.LatLng(32.741082,-114.815575)),types:["establishment","geocode"]},b=new google.maps.places.Autocomplete(document.getElementById("vehicle_search_address"),c),google.maps.event.addListener(this.map,"idle",a(function(b){var c;if(!this.mapInitialized){this.mapInitialized=!0,this.resizePanes(),google.maps.event.trigger(this.map,"resize"),this.map.setCenter(this.query.gLatLng()),this.mapOverlay=new google.maps.OverlayView,this.mapOverlay.draw=function(){},this.mapOverlay.setMap(this.map),google.maps.event.addListener(this.map,"dragend",a(function(a){return this.onMapMove()},this)),google.maps.event.addListener(this.map,"zoom_changed",a(function(a){return this.onZoomChange()},this)),c=this,$(window).resize($.debounce(500,function(){return c.onMapResize()})),this.restoredSearch?searchPageController.doSearch("restore"):this.vehicles.length>0&&(this.repositionMap(),this.drawSearchMarkers());if($.browser.msie&&$.browser.version<="8.0")return setTimeout(a(function(){return this.resizePanes(),google.maps.event.trigger(this.map,"resize"),this.map.setCenter(this.query.gLatLng())},this),3e3)}},this))},b.prototype.reDrawMarkers=function(a){var b,c;for(b in this.vehicleIndexToMarkerMap)c=this.vehicleIndexToMarkerMap[b],c.setMap(null);this.vehicles=a;if(this.vehicles.length>0)return this.drawSearchMarkers(!0)},b.prototype.resetZoom=function(a){return this.map.setZoom(this.defaultZoom)},b.prototype.repositionMap=function(){var a;return a=this.query.gLatLng(),this.map.setCenter(a)},b.prototype.restoreMap=function(){return this.map.setCenter(this.query.gLatLng()),this.map.setZoom(this.query.getZoom())},b.prototype.drawSearchMarkers=function(b){var c,d,e,f,g,h,i,j,k,l,m,n;e=0,n=[];while(e<this.vehicles.length)m=this.vehicles[e],m.postal_address?h=new google.maps.LatLng(m.postal_address.lat,m.postal_address.lng):h=new google.maps.LatLng(m.lat,m.lng),d=51,c=13,k=0,j=e*81,i="/vehicles/"+m.id,!this.anytimeMode&&this.startTime&&this.endTime&&(i+="?start_time="+this.startTime.getTime()/1e3+"&end_time="+this.endTime.getTime()/1e3),this.user&&m.can_reserve&&m.available?j+=27:m.available?j+=0:j+=54,f=new google.maps.MarkerImage("/images/vehicles/pins/map-pins.png",new google.maps.Size(28,51),new google.maps.Point(j,k),new google.maps.Point(c,d)),g=this.mapOverlay,l=this,function(e,f,g,i,k){var l,m,n;return m=h,n={position:m,map:k.map,zIndex:100-f,icon:i,sprite_x:j,flagpole_x:c,flagpole_y:d},b||$.extend(n,{animation:google.maps.Animation.DROP}),l=new google.maps.Marker(n),k.vehicleIndexToMarkerMap[f]=l,google.maps.event.addListener(l,"click",function(a)
{if(g!=="none")return window.location.href=g}),google.maps.event.addListener(l,"mouseover",a(function(a){return k.focusVehicle(f,!0)},this)),google.maps.event.addListener(l,"mouseout",a(function(a){return k.delayBlurVehicle()},this))}(m,e,i,f,l),n.push(e++);return n},b.prototype.focusVehicle=function(a,b){var c,d,e,f,g,h,i,j;if(this.focusedVehicleId===a)return clearTimeout(this.blurVehicleTimeout),!1;this.focusedVehicleId!==null&&this.blurVehicle(this.focusedVehicleId),e=this.vehicleIndexToMarkerMap[a];if(!e)return;i=this.vehicles[a],g=new Number(i.price_per_hour),f=new Number(i.price_per_day),j=this.mapOverlay.getProjection().fromLatLngToContainerPixel(e.position),c='<div class="carmap-overlay"><div class="photo"><span class="vehicle-number">'+(a+1)+'</span><img class="vehicle-img" src="'+i.highlight_photo_url+'"></div><div class="mid">'+i.year+" "+i.make+" "+i.model+'<span class="price"><strong>$'+g.toFixed(2)+"</strong>/hr&nbsp;&nbsp;<strong>$"+f.toFixed(2)+'</strong>/day</span></div><div class="clear"></div></div>',this.showOverlay(Math.round(j.x),Math.round(j.y),c),e.getIcon().origin=new google.maps.Point(e.sprite_x,51),e.setIcon(e.getIcon()),e.zIndex=this.max_pin_z_index++,d=$(".vehicles .vehicle").eq(a),d.addClass("focused"),this.focusedVehicleId=a,h=$(document).scrollTop();if(b)if(d.offset().top+d.outerHeight()>$(window).height()+h||d.offset().top<h+$("#toolbar").outerHeight())return $("body").stop(!0,!1).animate({scrollTop:d.offset().top-this.toolbarBottom},300)},b.prototype.blurVehicle=function(a){var b;clearTimeout(this.blurVehicleTimeout),b=this.vehicleIndexToMarkerMap[a];if(!b)return;return this.hideOverlay(),b.getIcon().origin=new google.maps.Point(b.sprite_x,0),b.setIcon(b.getIcon()),$(".vehicles .vehicle").removeClass("focused"),this.focusedVehicleId=null},b.prototype.delayBlurVehicle=function(){return this.blurVehicleTimeout=setTimeout(a(function(){if(this.focusedVehicleId!==null)return this.blurVehicle(this.focusedVehicleId)},this),100)},b.prototype.showOverlay=function(a,b,c){var d,e;return e=$('<div class="vehicleTooltipContainer"><div class="pointerUp"></div><div class="vehicleTooltip"><div class="content">'+c+'</div></div><div class="pointerDown"></div></div>'),d=e.find(".vehicleTooltip"),e.css({display:"block",position:"absolute",left:-3e3,top:0}),$("#mapFrame").append(e),b<220?e.addClass("up").css({top:b+10,bottom:"auto"}):e.css({bottom:$("#mapFrame").height()-b+70,top:"auto"}),e.css({position:"absolute",left:a-Math.round(e.outerWidth()/2),display:"none"}),e.show()},b.prototype.hideOverlay=function(){return $(".vehicleTooltipContainer").each(function(){return $(this).hide()})},b.prototype.resizePanes=function(){var a;return a=$(window).height(),this.mapElement.height(a),this.mapElement.width($(window).width()-this.resultsWidth),$("#results").css({"min-height":a-parseInt($("#results").css("padding-top"))+"px"})},b.prototype.onStartTimeChange=function(){return this.startTimeSelect.val()===""?(this.setAnytime(!0),this.endTimeSelect.val(""),this.endTime=date.getDateTime(this.endDateTextArea,this.endTimeSelect)):this.setAnytime(!1),this.startTime=date.getDateTime(this.startDateTextArea,this.startTimeSelect),this.startTime.getTime()<$.now()&&(this.startTime=date.nextPossibleReservationStart(),this.endTime=new Date,this.endTime.setTime(this.startTime.getTime()+18e5)),this.startTime.getTime()>this.endTime.getTime()-18e5&&this.endTime.setTime(this.startTime.getTime()+18e5),this.setDateTimes(),this.doSearch()},b.prototype.onEndTimeChange=function(){return this.endTimeSelect.val()===""?(this.setAnytime(!0),this.startTimeSelect.val(""),this.startTime=date.getDateTime(this.startDateTextArea,this.startTimeSelect)):this.setAnytime(!1),this.endTime=date.getDateTime(this.endDateTextArea,this.endTimeSelect),this.endTime.getTime()<date.nextPossibleReservationStart()&&(this.startTime=date.nextPossibleReservationStart(),this.endTime=new Date,this.endTime.setTime(this.startTime.getTime()+18e5)),this.startTime.getTime()>this.endTime.getTime()-18e5&&(this.anytimeMode?this.startTime.setTime(this.endTime.getTime()):this.startTime.setTime(this.endTime.getTime()-18e5)),this.setDateTimes(),this.doSearch()},b.prototype.onMapMove=function(){var a;return a=this.map.getCenter(),this.query.set({lat:a.lat(),lng:a.lng(),address:null}),this.setViewport(),this.addressField.val(""),this.doSearch()},b.prototype.onMapResize=function(){var a;return this.resizePanes(),a=this.map.getCenter(),this.query.set({lat:a.lat(),lng:a.lng(),address:null}),this.setViewport(),this.addressField.val(""),this.doSearch(),google.maps.event.trigger(this.map,"resize")},b.prototype.onZoomChange=function(){var a;return this.query.setZoom(this.map.getZoom()),a=this.map.getCenter(),this.query.set({lat:a.lat(),lng:a.lng(),address:null}),this.setViewport(),this.addressField.val(""),this.doSearch()},b.prototype.setViewport=function(){var a,b,c;return a=this.map.getBounds(),b=a.getNorthEast(),c=a.getSouthWest(),this.query.setViewport(b.lat(),b.lng(),c.lat(),c.lng())},b}(),window.SearchRequestParams=function(){function a(a){this.params={lat:null,lng:null,address:null,start_time:null,end_time:null,anytime:null,zoom:12,upper_lat:null,upper_lng:null,lower_lat:null,lower_lng:null},this.set(a)}return a.prototype.set=function(a,b){return typeof a=="object"?$.extend(this.params,a):this.params[a]=b},a.prototype.setViewport=function(a,b,c,d){return this.params.upper_lat=a,this.params.upper_lng=b,this.params.lower_lat=c,this.params.lower_lng=d},a.prototype.setZoom=function(a){return this.params.zoom=a},a.prototype.getZoom=function(){return parseInt(this.params.zoom)},a.prototype.latlng=function(){return{lat:this.params.lat,lng:this.params.lng}},a.prototype.gLatLng=function(){return new google.maps.LatLng(this.params.lat,this.params.lng)},a.prototype.apiSafeParams=function(){var a,b;b=$.extend({},this.params);for(a in b)(b[a]===null||a==="zoom")&&delete b[a],b.address&&(delete b.lat,delete b.lng);return b},a}()}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};window.VehiclePageController=function(){function b(b){var c,d;this.config=b,$("#map").mouseenter(function(){var b;return clearTimeout(this.mapExpandTimer),clearTimeout(this.mapContractTimer),b=$(this),this.mapExpandTimer=setTimeout(function(){var c,d;return c=b.data("initialHeight")||b.height(),d=setInterval(a(function(){return mapController.resetCenter()},this),15),b.data("initialHeight",c).stop(!0,!0).animate({height:450},function(){return clearInterval(d),mapController.resetCenter()})},300)}).mouseleave(function(){var b;return clearTimeout(this.mapExpandTimer),clearTimeout(this.mapContractTimer),b=$(this),this.mapContractTimer=setTimeout(function(){var c,d;return c=b.data("initialHeight"),d=setInterval(a(function(){return mapController.resetCenter()},this),15),b.stop(!0,!0).animate({height:c},function(){return clearInterval(d),mapController.resetCenter()})},300)}),this.vehicleId=this.config.vehicleId,this.getMutualFriends(this.vehicleId),d=utils.getURLParameter("start_time"),c=utils.getURLParameter("end_time"),window.availabilityDisplayController=new window.AvailabilityDisplayController({start:parseInt(d)*1e3,end:parseInt(c)*1e3,target:"#availabilitySchedule",vehicleId:this.vehicleId})}return b.prototype.setMapToVehicle=function(a){var b;this.centerLocation=new google.maps.LatLng(a.postal_address.lat,a.postal_address.lng),this.mapElementId="#map",this.googleMapOptions={zoom:14,center:this.centerLocation,mapTypeId:google.maps.MapTypeId.ROADMAP},this.map=new google.maps.Map(document.getElementById(this.mapElementId),this.googleMapOptions);return},b.prototype.currentVehicle=function(a){var b;return b=jQuery.map(mapConfig.vehicles,function(b){if(b.id===parseInt(a.target.parentNode.id))return b})},b.prototype.getMutualFriends=function(a){return this.config.loggedIn?$.ajax({url:"/vehicles/"+a+"/mutual_friends?format=html",success:function(a){return $("#mutualFriends").html("<h4>Mutual Friends</h4>"),a===""?$("#mutualFriends").append("You don't have any mutual friends"):$("#mutualFriends").append(a)},error:function(){return console.log("unable to get mutual friends")}}):$("#mutualFriends").html('<a href="/auth/facebook">Login to</a> see mutual friends')},b}()}.call(this);